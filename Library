local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local isMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled

-- [SISTEMA DE ARQUIVOS] --
-- Verifica e cria a pasta de configs ao iniciar
local ConfigFolderName = "AlphaxConfigs"
local function InitConfigFolder()
    if makefolder and isfolder then
        if not isfolder(ConfigFolderName) then
            makefolder(ConfigFolderName)
        end
    end
end
pcall(InitConfigFolder) -- Executa protegido contra erros

local Library = {
    Binds = {},
    Config = { 
        MenuOpen = true,
        MenuKey = Enum.KeyCode.RightControl,
        Theme = {
            Main = Color3.fromRGB(25, 25, 31),
            Container = Color3.fromRGB(30, 30, 35),
            TabTextColor = Color3.fromRGB(240, 240, 240),
            Accent = Color3.fromRGB(0, 0, 240),
            Text = Color3.fromRGB(240, 240, 240),
            SubText = Color3.fromRGB(150, 150, 150),
            Outline = Color3.fromRGB(50, 50, 55),
            NotifyBg = Color3.fromRGB(25, 25, 30),
            BindWait = Color3.fromRGB(255, 50, 50)
        },
        FolderName = ConfigFolderName -- Salva o nome da pasta na config
    }
}

local UI_Elements = {}
local ActiveNotifications = {}
local Connections = {} 
local LibraryConfig = Library.Config 

-- [FUNÇÃO EXTRA] Cortar texto
local function TruncateText(text, limit)
    if not text then return "" end
    if #text > limit then
        return string.sub(text, 1, limit) .. "..."
    end
    return text
end

-- [SISTEMA] Stream Proof
local function GetStreamProofParent()
    local Success, Result = pcall(function()
        return gethui and gethui() or (get_hidden_gui and get_hidden_gui())
    end)
    if Success and Result then return Result end
    return CoreGui
end

local ParentObj = GetStreamProofParent()

if ParentObj:FindFirstChild("Alphax_UI_Lib") then 
    ParentObj.Alphax_UI_Lib:Destroy() 
end

local function GetNextOrder(Container)
    local max = 0
    for _, c in pairs(Container:GetChildren()) do
        if c:IsA("GuiObject") and c.LayoutOrder > max then
            max = c.LayoutOrder
        end
    end
    return max + 1
end

local function GetScreen()
    if UI_Elements.ScreenGui then return UI_Elements.ScreenGui end
    local Screen = Instance.new("ScreenGui")
    Screen.Name = "Alphax_UI_Lib"
    Screen.ResetOnSpawn = false
    Screen.IgnoreGuiInset = true 
    Screen.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    Screen.DisplayOrder = 10000 
    if syn and syn.protect_gui and not gethui then syn.protect_gui(Screen) end
    Screen.Parent = ParentObj
    UI_Elements.ScreenGui = Screen
    return Screen
end

function Library:Unload()
    if UI_Elements.ScreenGui then UI_Elements.ScreenGui:Destroy() end
    for _, conn in pairs(Connections) do conn:Disconnect() end
    table.clear(Connections)
    table.clear(Library.Binds)
    table.clear(UI_Elements)
end

-- [NOTIFICAÇÕES]
function Library:Notify(Text, Duration)
    local Dur = Duration or 3
    local Screen = GetScreen()
    
    local Holder = UI_Elements.NotifyHolder
    if not Holder then
        Holder = Instance.new("Frame", Screen)
        Holder.Name = "NotifyHolder"
        Holder.Size = UDim2.new(0, 300, 1, 0)
        Holder.Position = UDim2.new(1, -310, 0, 50)
        Holder.BackgroundTransparency = 1
        UI_Elements.NotifyHolder = Holder
    end
    
    local NotifyFrame = Instance.new("Frame", Holder)
    NotifyFrame.Size = UDim2.new(1, 0, 0, 45); NotifyFrame.Position = UDim2.new(1, 20, 0, 20)
    NotifyFrame.BackgroundColor3 = LibraryConfig.Theme.NotifyBg
    Instance.new("UICorner", NotifyFrame).CornerRadius = UDim.new(0, 6)
    Instance.new("UIStroke", NotifyFrame).Color = LibraryConfig.Theme.Outline
    
    local Label = Instance.new("TextLabel", NotifyFrame); Label.Size = UDim2.new(1, -20, 1, -5); Label.Position = UDim2.new(0, 10, 0, 0)
    Label.BackgroundTransparency = 1; Label.Text = Text; Label.TextColor3 = LibraryConfig.Theme.Text; Label.Font = Enum.Font.GothamBold; Label.TextSize = 14; Label.TextXAlignment = Enum.TextXAlignment.Left
    
    local TimerFill = Instance.new("Frame", NotifyFrame); TimerFill.Size = UDim2.new(1, 0, 0, 2); TimerFill.Position = UDim2.new(0, 0, 1, -2); TimerFill.BackgroundColor3 = LibraryConfig.Theme.Accent
    
    table.insert(ActiveNotifications, 1, NotifyFrame)
    
    TweenService:Create(NotifyFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back), {Position = UDim2.new(0, 0, 0, 20)}):Play()
    for i = 2, #ActiveNotifications do if ActiveNotifications[i].Parent then TweenService:Create(ActiveNotifications[i], TweenInfo.new(0.3), {Position = UDim2.new(0, 0, 0, 20 + ((i - 1) * 55))}):Play() end end
    
    TweenService:Create(TimerFill, TweenInfo.new(Dur, Enum.EasingStyle.Linear), {Size = UDim2.new(0, 0, 0, 2)}):Play()
    
    task.delay(Dur, function()
        if NotifyFrame.Parent then
            TweenService:Create(NotifyFrame, TweenInfo.new(0.3), {Position = UDim2.new(1, 20, 0, NotifyFrame.Position.Y.Offset)}):Play()
            task.wait(0.3); NotifyFrame:Destroy()
            for i,v in pairs(ActiveNotifications) do if v == NotifyFrame then table.remove(ActiveNotifications, i) end end
        end
    end)
end

-- [KEY SYSTEM]
function Library:KeySystem(Settings)
    if not Settings or not Settings.Enabled then return end

    local Verified = false
    local Screen = GetScreen()
    
    local BlurFrame = Instance.new("Frame", Screen)
    BlurFrame.Size = UDim2.new(1, 0, 1, 0)
    BlurFrame.BackgroundColor3 = Color3.new(0,0,0)
    BlurFrame.BackgroundTransparency = 0.5
    BlurFrame.ZIndex = 9999
    
    local KeyFrame = Instance.new("Frame", Screen)
    KeyFrame.Name = "KeySystemFrame"
    KeyFrame.Size = UDim2.new(0, 0, 0, 0) 
    KeyFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    KeyFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    KeyFrame.BackgroundColor3 = LibraryConfig.Theme.Main
    KeyFrame.ClipsDescendants = true
    KeyFrame.ZIndex = 10000
    
    Instance.new("UICorner", KeyFrame).CornerRadius = UDim.new(0, 8)
    Instance.new("UIStroke", KeyFrame).Color = LibraryConfig.Theme.Outline

    local dragging, dragInput, dragStart, startPos
    local function update(input)
        local delta = input.Position - dragStart
        KeyFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    KeyFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true; dragStart = input.Position; startPos = KeyFrame.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end)
        end
    end)
    KeyFrame.InputChanged:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end end)
    UserInputService.InputChanged:Connect(function(input) if input == dragInput and dragging then update(input) end end)

    local keySizeX = isMobile and 320 or 400
    local keySizeY = isMobile and 200 or 250
    TweenService:Create(KeyFrame, TweenInfo.new(0.6, Enum.EasingStyle.Back), {Size = UDim2.new(0, keySizeX, 0, keySizeY)}):Play()
    
    local Title = Instance.new("TextLabel", KeyFrame)
    Title.Text = Settings.Title or "Key System"
    Title.Size = UDim2.new(1, 0, 0, 40)
    Title.BackgroundTransparency = 1
    Title.TextColor3 = LibraryConfig.Theme.Accent
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 20
    
    local InputBg = Instance.new("Frame", KeyFrame)
    InputBg.Size = UDim2.new(0.8, 0, 0, 35)
    InputBg.Position = UDim2.new(0.1, 0, 0, 70)
    InputBg.BackgroundColor3 = LibraryConfig.Theme.Container
    Instance.new("UICorner", InputBg).CornerRadius = UDim.new(0, 4)
    local InputStroke = Instance.new("UIStroke", InputBg); InputStroke.Color = LibraryConfig.Theme.Outline
    
    local InputBox = Instance.new("TextBox", InputBg)
    InputBox.Size = UDim2.new(1, -20, 1, 0)
    InputBox.Position = UDim2.new(0, 10, 0, 0)
    InputBox.BackgroundTransparency = 1
    InputBox.TextColor3 = LibraryConfig.Theme.Text
    InputBox.PlaceholderText = "Cole a Key Aqui..."
    InputBox.PlaceholderColor3 = Color3.fromRGB(100, 100, 100)
    InputBox.Font = Enum.Font.Gotham
    InputBox.TextSize = 14
    InputBox.TextXAlignment = Enum.TextXAlignment.Left
    InputBox.Text = ""
    
    local CheckBtn = Instance.new("TextButton", KeyFrame)
    CheckBtn.Text = "Verificar Key"
    CheckBtn.Size = UDim2.new(0.8, 0, 0, 35)
    CheckBtn.Position = UDim2.new(0.1, 0, 0, 115)
    CheckBtn.BackgroundColor3 = LibraryConfig.Theme.Accent
    CheckBtn.TextColor3 = Color3.fromRGB(20, 20, 20)
    CheckBtn.Font = Enum.Font.GothamBold
    CheckBtn.TextSize = 14
    Instance.new("UICorner", CheckBtn).CornerRadius = UDim.new(0, 4)
    
    local LinkContainer = Instance.new("Frame", KeyFrame)
    LinkContainer.Size = UDim2.new(0.8, 0, 0, 35)
    LinkContainer.Position = UDim2.new(0.1, 0, 0, 160)
    LinkContainer.BackgroundTransparency = 1
    
    local function CreateLinkBtn(Text, Url, PosX, SizeX)
        local LBtn = Instance.new("TextButton", LinkContainer)
        LBtn.Text = Text
        LBtn.Size = UDim2.new(SizeX, 0, 1, 0)
        LBtn.Position = UDim2.new(PosX, 0, 0, 0)
        LBtn.BackgroundColor3 = LibraryConfig.Theme.Container
        LBtn.TextColor3 = LibraryConfig.Theme.Text
        LBtn.Font = Enum.Font.GothamBold
        LBtn.TextSize = 12
        Instance.new("UICorner", LBtn).CornerRadius = UDim.new(0, 4)
        Instance.new("UIStroke", LBtn).Color = LibraryConfig.Theme.Outline
        
        LBtn.MouseButton1Click:Connect(function()
            if setclipboard then
                setclipboard(Url)
                Library:Notify("Link copiado para a área de transferência!", 2)
            else
                Library:Notify("Seu executor não suporta setclipboard", 3)
            end
        end)
    end
    
    if Settings.Link1 and Settings.Link2 then
        CreateLinkBtn("Link da Key 1", Settings.Link1, 0, 0.48)
        CreateLinkBtn("Link da Key 2", Settings.Link2, 0.52, 0.48)
    elseif Settings.Link1 then
        CreateLinkBtn("Pegar Key (Link)", Settings.Link1, 0, 1)
    end
    
    local function Check()
        if InputBox.Text == Settings.Key then
            Library:Notify("Key Correta! Carregando...", 2)
            TweenService:Create(KeyFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Size = UDim2.new(0,0,0,0)}):Play()
            BlurFrame:Destroy()
            task.wait(0.4)
            KeyFrame:Destroy()
            Verified = true
        else
            Library:Notify("Key Inválida!", 2)
            InputBox.Text = ""
            local OldColor = InputStroke.Color
            InputStroke.Color = Color3.fromRGB(255, 50, 50)
            task.delay(0.5, function() InputStroke.Color = OldColor end)
        end
    end
    
    CheckBtn.MouseButton1Click:Connect(Check)

    repeat task.wait() until Verified
end

-- [JANELA PRINCIPAL ATUALIZADA COM MINIMIZAR E MAXIMIZAR]
function Library:Window(TitleText, SubTitleText)
    local Screen = GetScreen() 
    
    if not UI_Elements.NotifyHolder then
        local NH = Instance.new("Frame", Screen); NH.Name = "NotifyHolder"; NH.Size = UDim2.new(0, 300, 1, 0); NH.Position = UDim2.new(1, -310, 0, 50); NH.BackgroundTransparency = 1; UI_Elements.NotifyHolder = NH
    end
    
    local Main = Instance.new("Frame", Screen)
    Main.Name = "MainFrame"
    Main.AnchorPoint = Vector2.new(0.5, 0.5) 
    Main.Position = UDim2.new(0.5, 0, 0.5, 0) 
    Main.Size = UDim2.new(0, 0, 0, 0) 
    Main.ClipsDescendants = true 
    Main.BackgroundColor3 = LibraryConfig.Theme.Main
    Main.Visible = true 
    
    Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 8)
    Instance.new("UIStroke", Main).Color = LibraryConfig.Theme.Outline
    UI_Elements.MainFrame = Main 

    -- Tamanho padrão da UI
    local mainSizeX = isMobile and 450 or 580
    local mainSizeY = isMobile and 320 or 500
    local DefaultSize = UDim2.new(0, mainSizeX, 0, mainSizeY)
    TweenService:Create(Main, TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = DefaultSize}):Play()
    
    local Top = Instance.new("Frame", Main)
    Top.Size = UDim2.new(1, 0, 0, 45)
    Top.BackgroundTransparency = 1
    
    -- [[ TÍTULO E SUBTÍTULO ]] --
    local Title = Instance.new("TextLabel", Top)
    Title.Text = TitleText
    Title.TextColor3 = LibraryConfig.Theme.Text
    Title.Font = Enum.Font.GothamBold
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.BackgroundTransparency = 1
    
    if SubTitleText and SubTitleText ~= "" then
        Title.TextSize = 15 
        Title.Size = UDim2.new(1, -140, 0, 20) -- Ajustei largura para não bater nos botões
        Title.Position = UDim2.new(0, 20, 0, 6)
        
        local SubTitle = Instance.new("TextLabel", Top)
        SubTitle.Text = SubTitleText
        SubTitle.TextColor3 = LibraryConfig.Theme.SubText
        SubTitle.Font = Enum.Font.Gotham
        SubTitle.TextSize = 12
        SubTitle.Size = UDim2.new(1, -140, 0, 15)
        SubTitle.Position = UDim2.new(0, 20, 0, 24)
        SubTitle.TextXAlignment = Enum.TextXAlignment.Left
        SubTitle.BackgroundTransparency = 1
    else
        Title.TextSize = 18
        Title.Size = UDim2.new(1, -140, 1, 0)
        Title.Position = UDim2.new(0, 20, 0, 0)
    end
    
    -- [VARIÁVEIS DE CONTROLE]
    local isMinimized = false
    local isMaximized = false
    local PreMaximizePos = UDim2.new(0.5, 0, 0.5, 0) -- Salva posição antes de maximizar
    local PreMaximizeSize = DefaultSize -- Salva tamanho antes de maximizar

    -- [[ BOTÃO FECHAR (X) ]] --
    local Close = Instance.new("TextButton", Top)
    Close.Name = "CloseBtn"
    if isMobile then Close.Visible = false end
    Close.Text = "X"
    Close.Size = UDim2.new(0, 45, 1, 0)
    Close.Position = UDim2.new(1, -45, 0, 0)
    Close.BackgroundTransparency = 1
    Close.TextColor3 = Color3.fromRGB(255, 100, 100) -- Vermelho claro
    Close.Font = Enum.Font.GothamBold
    Close.TextSize = 18
    Close.MouseButton1Click:Connect(function() 
        TweenService:Create(Main, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Size = UDim2.new(0,0,0,0)}):Play()
        task.wait(0.4)
        Library:Unload()
    end)

    -- [[ BOTÃO MAXIMIZAR (Quadrado) ]] --
    local Maximize = Instance.new("TextButton", Top)
    Maximize.Name = "MaxBtn"
    if isMobile then Maximize.Visible = false end
    Maximize.Text = "□" -- Ícone simples de quadrado
    Maximize.Size = UDim2.new(0, 45, 1, 0)
    Maximize.Position = UDim2.new(1, -90, 0, 0) -- Ao lado do fechar
    Maximize.BackgroundTransparency = 1
    Maximize.TextColor3 = LibraryConfig.Theme.SubText
    Maximize.Font = Enum.Font.GothamBold
    Maximize.TextSize = 18

    Maximize.MouseButton1Click:Connect(function()
        isMaximized = not isMaximized
        
        if isMaximized then
            -- Salva estado atual antes de maximizar
            PreMaximizePos = Main.Position
            -- Se não estiver minimizado, salva o tamanho atual, senão usa o padrão
            if not isMinimized then PreMaximizeSize = Main.Size end
            
            isMinimized = false -- Garante que abra se estiver minimizado
            
            -- Ocupa a tela toda
            TweenService:Create(Main, TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {
                Size = UDim2.new(1, 0, 1, 0),
                Position = UDim2.new(0.5, 0, 0.5, 0),
                AnchorPoint = Vector2.new(0.5, 0.5)
            }):Play()
        else
            -- Restaura tamanho original (DefaultSize)
            TweenService:Create(Main, TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {
                Size = DefaultSize,
                Position = PreMaximizePos
            }):Play()
        end
    end)

    -- [[ BOTÃO MINIMIZAR (Traço) ]] --
    local Minimize = Instance.new("TextButton", Top)
    Minimize.Name = "MinBtn"
    if isMobile then Minimize.Visible = false end
    Minimize.Text = "-"
    Minimize.Size = UDim2.new(0, 45, 1, 0)
    Minimize.Position = UDim2.new(1, -135, 0, 0) -- Ao lado do maximizar
    Minimize.BackgroundTransparency = 1
    Minimize.TextColor3 = LibraryConfig.Theme.SubText
    Minimize.Font = Enum.Font.GothamBold
    Minimize.TextSize = 24 -- Um pouco maior para o traço ficar visível

    Minimize.MouseButton1Click:Connect(function()
        isMinimized = not isMinimized
        
        if isMinimized then
            -- Se estiver maximizado, salva isso pra depois
            if not isMaximized then PreMaximizeSize = Main.Size end
            
            -- Recolhe deixando só a barra (Altura 45)
            TweenService:Create(Main, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Size = UDim2.new(Main.Size.X.Scale, Main.Size.X.Offset, 0, 45)
            }):Play()
        else
            -- Abre de volta
            local RestoreSize = isMaximized and UDim2.new(1,0,1,0) or DefaultSize
            
            TweenService:Create(Main, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                Size = RestoreSize
            }):Play()
        end
    end)
    
    local SidebarWidth = isMobile and 110 or 140
    local SidebarPadding = 15
    local UserProfileHeight = 60

    local TabsC = Instance.new("ScrollingFrame", Main) 
    TabsC.Name = "TabsContainer"
    TabsC.Size = UDim2.new(0, SidebarWidth, 1, -(55 + UserProfileHeight)) 
    TabsC.Position = UDim2.new(0, SidebarPadding, 0, 45) 
    TabsC.BackgroundColor3 = LibraryConfig.Theme.Container
    
    TabsC.ScrollBarThickness = isMobile and 6 or 2 
    TabsC.ScrollBarImageColor3 = LibraryConfig.Theme.Accent 
    TabsC.AutomaticCanvasSize = Enum.AutomaticSize.Y 
    TabsC.CanvasSize = UDim2.new(0,0,0,0) 
    TabsC.BorderSizePixel = 0
    
    Instance.new("UICorner", TabsC).CornerRadius = UDim.new(0, 6)
    
    local TabList = Instance.new("UIListLayout", TabsC)
    TabList.Padding = UDim.new(0, 5)
    TabList.HorizontalAlignment = Enum.HorizontalAlignment.Center 
    TabList.SortOrder = Enum.SortOrder.LayoutOrder
    
    Instance.new("UIPadding", TabsC).PaddingTop = UDim.new(0, 10)
    UI_Elements.Tabs = TabsC
    
    -- [[ USER PROFILE ]] --
    local ProfileFrame = Instance.new("Frame", Main)
    ProfileFrame.Name = "UserProfile"
    ProfileFrame.Size = UDim2.new(0, SidebarWidth, 0, 50)
    ProfileFrame.Position = UDim2.new(0, SidebarPadding, 1, -65) 
    ProfileFrame.BackgroundColor3 = LibraryConfig.Theme.Container
    Instance.new("UICorner", ProfileFrame).CornerRadius = UDim.new(0, 6)
    Instance.new("UIStroke", ProfileFrame).Color = LibraryConfig.Theme.Outline
    
    local AvatarImg = Instance.new("ImageLabel", ProfileFrame)
    AvatarImg.Size = UDim2.new(0, 36, 0, 36)
    AvatarImg.Position = UDim2.new(0, 8, 0.5, -18)
    AvatarImg.BackgroundColor3 = LibraryConfig.Theme.Main
    AvatarImg.Image = Players:GetUserThumbnailAsync(LocalPlayer.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size48x48)
    Instance.new("UICorner", AvatarImg).CornerRadius = UDim.new(1, 0)
    Instance.new("UIStroke", AvatarImg).Color = LibraryConfig.Theme.Accent
    
    local DispLabel = Instance.new("TextLabel", ProfileFrame)
    DispLabel.Text = TruncateText(LocalPlayer.DisplayName, 13) 
    DispLabel.Size = UDim2.new(1, -55, 0, 20)
    DispLabel.Position = UDim2.new(0, 50, 0, 6)
    DispLabel.BackgroundTransparency = 1
    DispLabel.TextColor3 = LibraryConfig.Theme.Text
    DispLabel.Font = Enum.Font.GothamBold
    DispLabel.TextSize = 13
    DispLabel.TextXAlignment = Enum.TextXAlignment.Left
    
    local UserLabel = Instance.new("TextLabel", ProfileFrame)
    UserLabel.Text = "@" .. TruncateText(LocalPlayer.Name, 16)
    UserLabel.Size = UDim2.new(1, -55, 0, 15)
    UserLabel.Position = UDim2.new(0, 50, 0, 24)
    UserLabel.BackgroundTransparency = 1
    UserLabel.TextColor3 = LibraryConfig.Theme.SubText
    UserLabel.Font = Enum.Font.Gotham
    UserLabel.TextSize = 11
    UserLabel.TextXAlignment = Enum.TextXAlignment.Left

    UI_Elements.Pages = Instance.new("Frame", Main)
    UI_Elements.Pages.Size = UDim2.new(1, -(SidebarWidth + 40), 1, -55) 
    UI_Elements.Pages.Position = UDim2.new(0, SidebarWidth + 30, 0, 45) 
    UI_Elements.Pages.BackgroundTransparency = 1
    UI_Elements.Pages.Parent = Main
    
    local drag, startPos, dragStart
    local function UpdateInput(input)
        local delta = input.Position - dragStart
        -- Se estiver maximizado, não permite arrastar (opcional, mas recomendado)
        if not isMaximized then
            Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end
    Top.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            drag = true; dragStart = input.Position; startPos = Main.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then drag = false end end)
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if drag and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then UpdateInput(input) end
    end)
end

function Library:Tab(Name, IsDevOnly)
    local IsUserDev = false
    if Library.Devs then
        for _, id in pairs(Library.Devs) do
            if LocalPlayer.UserId == id then
                IsUserDev = true
                break
            end
        end
    end

    if IsDevOnly and not IsUserDev then
        local HiddenPage = Instance.new("Frame", UI_Elements.Pages)
        HiddenPage.Visible = false
        HiddenPage.Name = Name .. "_HIDDEN"
        return HiddenPage
    end

    local B = Instance.new("TextButton", UI_Elements.Tabs)
    B.Size = UDim2.new(0.9, 0, 0, 35)
    B.BackgroundColor3 = Color3.fromRGB(40,40,45)
    B.Text = Name
    B.TextColor3 = LibraryConfig.Theme.SubText
    B.Font = Enum.Font.GothamBold
    B.TextSize = 12
    Instance.new("UICorner", B).CornerRadius = UDim.new(0,4)
    
    local P = Instance.new("ScrollingFrame", UI_Elements.Pages)
    P.Size = UDim2.new(1, 0, 1, 0)
    P.BackgroundTransparency = 1
    P.Visible = false
    P.ScrollBarThickness = isMobile and 6 or 2
    
    local LL = Instance.new("UIListLayout", P)
    LL.Padding = UDim.new(0, 6)
    LL.SortOrder = Enum.SortOrder.LayoutOrder
    Instance.new("UIPadding", P).PaddingTop = UDim.new(0, 5)
    
    B.MouseButton1Click:Connect(function() 
        for _,x in pairs(UI_Elements.Pages:GetChildren()) do x.Visible=false end
        for _,x in pairs(UI_Elements.Tabs:GetChildren()) do 
            if x:IsA("TextButton") then 
                x.TextColor3 = LibraryConfig.Theme.SubText
                x.BackgroundColor3 = Color3.fromRGB(40,40,45) 
            end 
        end
        P.Visible = true
        B.TextColor3 = LibraryConfig.Theme.Text
        B.BackgroundColor3 = Color3.fromRGB(50,50,55) 
    end)
    
    local VisibleTabs = 0
    for _, child in pairs(UI_Elements.Tabs:GetChildren()) do
        if child:IsA("TextButton") then VisibleTabs = VisibleTabs + 1 end
    end

    if VisibleTabs == 1 then 
         P.Visible = true
         B.TextColor3 = LibraryConfig.Theme.Text
         B.BackgroundColor3 = Color3.fromRGB(50,50,55)
    end
    
    return P
end

function Library:Section(P, Text)
    local l = Instance.new("TextLabel", P)
    l.Size = UDim2.new(0.98, 0, 0, 25)
    l.BackgroundTransparency = 1
    l.Text = Text
    l.TextColor3 = LibraryConfig.Theme.Text
    l.Font = Enum.Font.GothamBold
    l.TextSize = 14
    l.TextXAlignment = Enum.TextXAlignment.Left
    Instance.new("UIPadding", l).PaddingLeft = UDim.new(0, 5)
    l.LayoutOrder = GetNextOrder(P)
end

function Library:Toggle(P, T, Tab, Key, Call)
    Tab = Tab or {} 
    
    local b = Instance.new("TextButton", P)
    b.Size = UDim2.new(0.98, 0, 0, 35)
    b.BackgroundColor3 = Color3.fromRGB(40,40,45)
    b.Text = ""
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 4)
    
    local l = Instance.new("TextLabel", b)
    l.Text = T
    l.Size = UDim2.new(0.7, 0, 1, 0)
    l.Position = UDim2.new(0, 0, 0, 0)
    l.BackgroundTransparency = 1
    l.TextColor3 = LibraryConfig.Theme.Text
    l.Font = Enum.Font.Gotham
    l.TextSize = 12
    l.TextXAlignment = Enum.TextXAlignment.Left
    Instance.new("UIPadding", l).PaddingLeft = UDim.new(0, 10)
    
    local BindLabel = Instance.new("TextLabel", b) 
    BindLabel.Size = UDim2.new(0, 30, 1, 0)
    BindLabel.Position = UDim2.new(1, -60, 0, 0)
    BindLabel.BackgroundTransparency = 1
    BindLabel.Text = ""
    BindLabel.TextColor3 = LibraryConfig.Theme.SubText
    BindLabel.Font = Enum.Font.GothamBold
    BindLabel.TextSize = 11
    BindLabel.TextXAlignment = Enum.TextXAlignment.Right
    
    local CheckFrame = Instance.new("Frame", b)
    CheckFrame.Size = UDim2.new(0, 20, 0, 20)
    CheckFrame.Position = UDim2.new(1, -25, 0.5, -10)
    Instance.new("UICorner", CheckFrame).CornerRadius = UDim.new(0, 4)
    
    local function UpdateState() 
        CheckFrame.BackgroundColor3 = Tab[Key] and LibraryConfig.Theme.Accent or Color3.fromRGB(60,60,60) 
    end
    UpdateState()
    
    local function ToggleAction()
        Tab[Key] = not Tab[Key]
        UpdateState()
        if Call then Call(Tab[Key]) end
    end
    
    b.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            ToggleAction()
        elseif input.UserInputType == Enum.UserInputType.MouseButton2 then
            BindLabel.Text = "..."
            BindLabel.TextColor3 = LibraryConfig.Theme.BindWait
            task.wait(0.2) 
            
            local Connection
            Connection = UserInputService.InputBegan:Connect(function(Input)
                if Input.UserInputType == Enum.UserInputType.Keyboard or (Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.MouseButton2 or Input.UserInputType == Enum.UserInputType.MouseButton3) then
                    
                    if Input.KeyCode == Enum.KeyCode.Backspace or Input.KeyCode == Enum.KeyCode.Delete then
                        Library.Binds[T] = nil
                        BindLabel.Text = ""
                    else
                        local BindData = {
                            Type = (Input.UserInputType == Enum.UserInputType.Keyboard) and "Key" or "Mouse",
                            Value = (Input.UserInputType == Enum.UserInputType.Keyboard) and Input.KeyCode or Input.UserInputType,
                            Action = ToggleAction
                        }
                        Library.Binds[T] = BindData
                        
                        if BindData.Type == "Key" then
                            BindLabel.Text = "["..Input.KeyCode.Name.."]"
                        else
                            local MouseMap = {[Enum.UserInputType.MouseButton1]="M1", [Enum.UserInputType.MouseButton2]="M2", [Enum.UserInputType.MouseButton3]="M3"}
                            BindLabel.Text = "["..(MouseMap[Input.UserInputType] or "M").."]"
                        end
                    end
                    
                    BindLabel.TextColor3 = LibraryConfig.Theme.SubText
                    Connection:Disconnect()
                end
            end)
        end
    end)
    b.LayoutOrder = GetNextOrder(P)
end

table.insert(Connections, UserInputService.InputBegan:Connect(function(Input, GameProcessed)
    if not GameProcessed then
        for _, BindData in pairs(Library.Binds) do
            if BindData.Type == "Key" and Input.KeyCode == BindData.Value then
                BindData.Action()
            elseif BindData.Type == "Mouse" and Input.UserInputType == BindData.Value then
                BindData.Action()
            end
        end
    end
end))

function Library:Button(P, T, C) 
    local b = Instance.new("TextButton", P)
    b.Size = UDim2.new(0.98, 0, 0, 35)
    b.BackgroundColor3 = LibraryConfig.Theme.Accent
    b.Text = T
    b.TextColor3 = Color3.new(0.1, 0.1, 0.1)
    b.Font = Enum.Font.GothamBold
    b.TextSize = 14
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 4)
    b.MouseButton1Click:Connect(C)
    b.LayoutOrder = GetNextOrder(P)
end

function Library:Slider(P, T, Tab, Key, Min, Max, Increment)
    Tab = Tab or {} 
    Increment = Increment or 0.1 -- Padrão SEMPRE 0.1 (suporta decimais)
    
    -- Calcula casas decimais baseado no incremento
    local DecimalPlaces = 1 -- Sempre mostra pelo menos 1 casa decimal
    if Increment < 1 then
        local str = tostring(Increment)
        if str:find("%.") then
            DecimalPlaces = #str - str:find("%.") 
        end
    end
    
    local f = Instance.new("Frame", P)
    f.Size = UDim2.new(0.98, 0, 0, 45)
    f.BackgroundColor3 = Color3.fromRGB(40,40,45)
    Instance.new("UICorner", f).CornerRadius = UDim.new(0, 4)
    
    local l = Instance.new("TextLabel", f)
    l.Size = UDim2.new(1, 0, 0, 20)
    l.BackgroundTransparency = 1
    l.TextColor3 = LibraryConfig.Theme.Text
    l.Font = Enum.Font.Gotham
    l.TextSize = 12
    l.TextXAlignment = Enum.TextXAlignment.Left
    Instance.new("UIPadding", l).PaddingLeft = UDim.new(0, 10)
    
    local b = Instance.new("TextButton", f)
    b.Text = ""
    b.Size = UDim2.new(0.9, 0, 0, 6)
    b.Position = UDim2.new(0.05, 0, 0.7, 0)
    b.BackgroundColor3 = Color3.fromRGB(20,20,20)
    Instance.new("UICorner", b).CornerRadius = UDim.new(1, 0)
    
    local fill = Instance.new("Frame", b)
    fill.BackgroundColor3 = LibraryConfig.Theme.Accent
    Instance.new("UICorner", fill).CornerRadius = UDim.new(1, 0)
    
    local function Up() 
        local v = Tab[Key] or Min 
        local p = (v - Min) / (Max - Min)
        fill.Size = UDim2.new(p, 0, 1, 0)
        
        -- SEMPRE formata com decimais
        l.Text = string.format("%s: %." .. DecimalPlaces .. "f", T, v)
    end
    Up()
    
    local drag
    b.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then drag = true end end)
    UserInputService.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then drag = false end end)
    UserInputService.InputChanged:Connect(function(i) 
        if drag and i.UserInputType == Enum.UserInputType.MouseMovement then 
            local p = math.clamp((i.Position.X - b.AbsolutePosition.X) / b.AbsoluteSize.X, 0, 1)
            local rawValue = Min + ((Max - Min) * p)
            
            -- Arredonda baseado no incremento
            Tab[Key] = math.floor(rawValue / Increment + 0.5) * Increment
            
            -- Garante que está dentro dos limites
            Tab[Key] = math.clamp(Tab[Key], Min, Max)
            
            Up() 
        end 
    end)
    f.LayoutOrder = GetNextOrder(P)
end

function Library:Keybind(P, T, Tab, Key, Call)
    Tab = Tab or {} 
    
    local b = Instance.new("TextButton", P)
    b.Size = UDim2.new(0.98, 0, 0, 35)
    b.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
    b.Text = ""
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 4)
    
    local l = Instance.new("TextLabel", b)
    l.Text = T
    l.Size = UDim2.new(0.6, 0, 1, 0)
    l.Position = UDim2.new(0, 10, 0, 0)
    l.BackgroundTransparency = 1
    l.TextColor3 = LibraryConfig.Theme.Text
    l.Font = Enum.Font.Gotham
    l.TextSize = 12
    l.TextXAlignment = Enum.TextXAlignment.Left
    
    local k = Instance.new("TextLabel", b)
    k.Size = UDim2.new(0.3, 0, 1, 0)
    k.Position = UDim2.new(0.65, 0, 0, 0)
    k.BackgroundTransparency = 1
    k.Font = Enum.Font.GothamBold
    k.TextSize = 12
    k.TextXAlignment = Enum.TextXAlignment.Right
    
    local function UpdateText()
        local val = Tab[Key]
        if val == nil or val == Enum.KeyCode.Unknown then
            k.Text = "[ None ]" 
            k.TextColor3 = LibraryConfig.Theme.SubText
        else
            k.Text = "[" .. val.Name .. "]"
            k.TextColor3 = LibraryConfig.Theme.Text
        end
    end
    UpdateText() 

    b.MouseButton1Click:Connect(function() 
        k.Text = "..."
        k.TextColor3 = LibraryConfig.Theme.BindWait
        local inputConn
        inputConn = UserInputService.InputBegan:Connect(function(i)
            if i.UserInputType == Enum.UserInputType.Keyboard then
                if i.KeyCode == Enum.KeyCode.Backspace or i.KeyCode == Enum.KeyCode.Delete then
                    Tab[Key] = nil
                    if Call then Call(nil) end
                else
                    Tab[Key] = i.KeyCode
                    if Call then Call(i.KeyCode) end
                end
                UpdateText()
                inputConn:Disconnect()
            end
        end)
    end)
    b.LayoutOrder = GetNextOrder(P)
end

-- [[ FUNÇÃO COLOR PICKER ATUALIZADA COM HEX ]] --
function Library:ColorPicker(P, T, Tab, Key, Default, Call)
    Tab = Tab or {}
    Default = Default or Color3.fromRGB(255, 255, 255)
    Tab[Key] = Tab[Key] or Default
    local h, s, v = Color3.toHSV(Tab[Key])
    
    local PickerFrame = Instance.new("Frame", P); PickerFrame.Size = UDim2.new(0.98, 0, 0, 35); PickerFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 45); PickerFrame.ClipsDescendants = true; Instance.new("UICorner", PickerFrame).CornerRadius = UDim.new(0, 4); PickerFrame.LayoutOrder = GetNextOrder(P)
    local ToggleBtn = Instance.new("TextButton", PickerFrame); ToggleBtn.Size = UDim2.new(1, 0, 0, 35); ToggleBtn.BackgroundTransparency = 1; ToggleBtn.Text = ""; ToggleBtn.ZIndex = 2
    local TitleLbl = Instance.new("TextLabel", ToggleBtn); TitleLbl.Text = T; TitleLbl.Size = UDim2.new(1, -50, 1, 0); TitleLbl.Position = UDim2.new(0, 10, 0, 0); TitleLbl.BackgroundTransparency = 1; TitleLbl.TextColor3 = LibraryConfig.Theme.Text; TitleLbl.Font = Enum.Font.Gotham; TitleLbl.TextSize = 12; TitleLbl.TextXAlignment = Enum.TextXAlignment.Left
    local ColorPreview = Instance.new("Frame", ToggleBtn); ColorPreview.Size = UDim2.new(0, 20, 0, 20); ColorPreview.Position = UDim2.new(1, -30, 0.5, -10); ColorPreview.BackgroundColor3 = Tab[Key]; Instance.new("UICorner", ColorPreview).CornerRadius = UDim.new(0, 4); Instance.new("UIStroke", ColorPreview).Color = LibraryConfig.Theme.Outline
    
    local ExpandContent = Instance.new("Frame", PickerFrame); ExpandContent.Size = UDim2.new(1, 0, 0, 110); ExpandContent.Position = UDim2.new(0, 0, 0, 35); ExpandContent.BackgroundTransparency = 1; ExpandContent.Visible = false
    
    -- Quadrado SV (Saturação/Valor)
    local SVImage = Instance.new("ImageLabel", ExpandContent); SVImage.Size = UDim2.new(0, 80, 0, 80); SVImage.Position = UDim2.new(0, 10, 0, 10); SVImage.BackgroundColor3 = Color3.fromHSV(h, 1, 1); SVImage.Image = "rbxassetid://4155801252"; Instance.new("UICorner", SVImage).CornerRadius = UDim.new(0, 4)
    local SVPicker = Instance.new("Frame", SVImage); SVPicker.Size = UDim2.new(0, 6, 0, 6); SVPicker.BackgroundColor3 = Color3.new(1,1,1); SVPicker.Position = UDim2.new(s, -3, 1 - v, -3); Instance.new("UICorner", SVPicker).CornerRadius = UDim.new(1, 0)
    
    -- Barra Hue (Arco-íris)
    local HueFrame = Instance.new("Frame", ExpandContent); HueFrame.Size = UDim2.new(1, -110, 0, 20); HueFrame.Position = UDim2.new(0, 100, 0, 10); HueFrame.BackgroundColor3 = Color3.new(1,1,1); Instance.new("UICorner", HueFrame).CornerRadius = UDim.new(0, 4)
    local HueGradient = Instance.new("UIGradient", HueFrame); HueGradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, Color3.new(1,0,0)), ColorSequenceKeypoint.new(0.17, Color3.new(1,1,0)), ColorSequenceKeypoint.new(0.33, Color3.new(0,1,0)), ColorSequenceKeypoint.new(0.5, Color3.new(0,1,1)), ColorSequenceKeypoint.new(0.67, Color3.new(0,0,1)), ColorSequenceKeypoint.new(0.83, Color3.new(1,0,1)), ColorSequenceKeypoint.new(1, Color3.new(1,0,0))})
    local HuePicker = Instance.new("Frame", HueFrame); HuePicker.Size = UDim2.new(0, 2, 1, 0); HuePicker.BackgroundColor3 = Color3.new(1,1,1); HuePicker.Position = UDim2.new(h, 0, 0, 0)

    -- [[ NOVO: HEX INPUT BOX ]] --
    local HexFrame = Instance.new("Frame", ExpandContent)
    HexFrame.Size = UDim2.new(1, -110, 0, 25) -- Largura preenche o espaço restante
    HexFrame.Position = UDim2.new(0, 100, 0, 45) -- Embaixo da barra Hue
    HexFrame.BackgroundColor3 = LibraryConfig.Theme.Main
    Instance.new("UICorner", HexFrame).CornerRadius = UDim.new(0, 4)
    Instance.new("UIStroke", HexFrame).Color = LibraryConfig.Theme.Outline
    
    local HexBox = Instance.new("TextBox", HexFrame)
    HexBox.Size = UDim2.new(1, 0, 1, 0)
    HexBox.BackgroundTransparency = 1
    HexBox.Text = "#FFFFFF"
    HexBox.TextColor3 = LibraryConfig.Theme.SubText
    HexBox.Font = Enum.Font.Gotham
    HexBox.TextSize = 12

    local function ToHex(Color)
        local r, g, b = math.floor(Color.R*255), math.floor(Color.G*255), math.floor(Color.B*255)
        return string.format("#%02X%02X%02X", r, g, b)
    end

    local function UpdateColor() 
        local NewColor = Color3.fromHSV(h, s, v)
        Tab[Key] = NewColor
        ColorPreview.BackgroundColor3 = NewColor
        SVImage.BackgroundColor3 = Color3.fromHSV(h, 1, 1)
        if not HexBox:IsFocused() then
            HexBox.Text = ToHex(NewColor)
        end
        if Call then Call(NewColor) end 
    end

    -- Lógica para digitar HEX
    -- ATUALIZADO: Agora funciona ao perder o foco (clicar fora), não só no Enter
    HexBox.FocusLost:Connect(function()
        -- 1. Se estiver vazio ou só espaços, restaura a cor anterior
        if HexBox.Text:gsub(" ", "") == "" then
            HexBox.Text = ToHex(Tab[Key])
            return
        end

        -- 2. Tenta converter o texto para cor
        local Success, Result = pcall(function() return Color3.fromHex(HexBox.Text) end)
        
        if Success and Result then
            -- Se for válido
            h, s, v = Color3.toHSV(Result)
            -- Atualiza posições visuais
            SVPicker.Position = UDim2.new(s, -3, 1 - v, -3)
            HuePicker.Position = UDim2.new(h, 0, 0, 0)
            UpdateColor()
        else
            -- Se for inválido, restaura a cor anterior
            HexBox.Text = ToHex(Tab[Key])
        end
    end)

    local DraggingHue, DraggingSV = false, false
    HueFrame.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then DraggingHue = true end end); SVImage.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then DraggingSV = true end end)
    UserInputService.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then DraggingHue = false; DraggingSV = false end end)
    UserInputService.InputChanged:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseMovement then 
        if DraggingHue then h = math.clamp((i.Position.X - HueFrame.AbsolutePosition.X) / HueFrame.AbsoluteSize.X, 0, 1); HuePicker.Position = UDim2.new(h, 0, 0, 0); UpdateColor()
        elseif DraggingSV then s = math.clamp((i.Position.X - SVImage.AbsolutePosition.X) / SVImage.AbsoluteSize.X, 0, 1); v = 1 - math.clamp((i.Position.Y - SVImage.AbsolutePosition.Y) / SVImage.AbsoluteSize.Y, 0, 1); SVPicker.Position = UDim2.new(s, -3, 1-v, -3); UpdateColor() end end end)
    local IsOpen = false; ToggleBtn.MouseButton1Click:Connect(function() IsOpen = not IsOpen; ExpandContent.Visible = IsOpen; TweenService:Create(PickerFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {Size = UDim2.new(0.98, 0, 0, IsOpen and 135 or 35)}):Play() end); 
    
    -- Inicialização correta
    SVPicker.Position = UDim2.new(s, -3, 1 - v, -3)
    HuePicker.Position = UDim2.new(h, 0, 0, 0)
    UpdateColor()
end

function Library:Dropdown(P, T, Opts, Tab, Key)
    Tab = Tab or {}
    
    local f = Instance.new("Frame", P); f.Size = UDim2.new(0.98, 0, 0, 35); f.BackgroundColor3 = Color3.fromRGB(40, 40, 45); f.ClipsDescendants = true; Instance.new("UICorner", f).CornerRadius = UDim.new(0, 4)
    local HeaderBtn = Instance.new("TextButton", f); HeaderBtn.Size = UDim2.new(1,0,0,35); HeaderBtn.BackgroundTransparency=1; HeaderBtn.Text=""
    local l = Instance.new("TextLabel", f)
    
    l.Text = string.format("%s: %s", tostring(T), tostring(Tab[Key] or "None"))
    
    l.Size = UDim2.new(1, -35, 0, 35); l.Position = UDim2.new(0, 10, 0, 0); l.BackgroundTransparency = 1; l.TextColor3 = LibraryConfig.Theme.Text; l.Font = Enum.Font.Gotham; l.TextSize = 12; l.TextXAlignment = Enum.TextXAlignment.Left
    
    local lst = Instance.new("ScrollingFrame", f); lst.Size = UDim2.new(1, 0, 0, 150); lst.Position = UDim2.new(0, 0, 0, 35); lst.BackgroundColor3 = Color3.fromRGB(35, 35, 40); lst.ScrollBarThickness = isMobile and 8 or 4; lst.BorderSizePixel = 0
    Instance.new("UIListLayout", lst).SortOrder = Enum.SortOrder.LayoutOrder
    
    local function UpdateList(NewOpts)
        Opts = NewOpts or Opts
        for _, child in pairs(lst:GetChildren()) do if child:IsA("TextButton") then child:Destroy() end end
        lst.CanvasSize = UDim2.new(0,0,0,#Opts*30)
        for _, o in pairs(Opts) do
            local ob = Instance.new("TextButton", lst); ob.Size = UDim2.new(1, 0, 0, 30); ob.BackgroundColor3 = Color3.fromRGB(35, 35, 40); ob.Text = o; ob.TextColor3 = Color3.fromRGB(200, 200, 200); ob.Font = Enum.Font.Gotham; ob.TextSize = 12; ob.BorderSizePixel = 0
            ob.MouseButton1Click:Connect(function() 
                Tab[Key] = o
                l.Text = string.format("%s: %s", tostring(T), tostring(o))
                TweenService:Create(f, TweenInfo.new(0.3), {Size = UDim2.new(0.98, 0, 0, 35)}):Play() 
            end)
        end
    end
    UpdateList()
    
    HeaderBtn.MouseButton1Click:Connect(function() 
        TweenService:Create(f, TweenInfo.new(0.3), {Size = UDim2.new(0.98, 0, 0, f.Size.Y.Offset == 35 and (35 + math.min(#Opts*30, 150)) or 35)}):Play() 
    end)
    f.LayoutOrder = GetNextOrder(P)
    
    return {
        Refresh = function(self, list) UpdateList(list) end,
        Set = function(self, val) 
            Tab[Key] = val
            l.Text = string.format("%s: %s", tostring(T), tostring(val or "None"))
        end
    }
end

function Library:PlayerDropdown(P, T, Tab, Key)
    local DropdownController = Library:Dropdown(P, T, {}, Tab, Key)
    
    local function UpdatePlayers()
        local Names = {}
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= Players.LocalPlayer then
                table.insert(Names, p.Name .. " | " .. p.DisplayName)
            end
        end
        DropdownController:Refresh(Names)
    end
    
    table.insert(Connections, Players.PlayerAdded:Connect(UpdatePlayers))
    table.insert(Connections, Players.PlayerRemoving:Connect(function(p)
        local FormattedName = p.Name .. " | " .. p.DisplayName
        if Tab[Key] == FormattedName then
            DropdownController:Set(nil)
        end
        UpdatePlayers()
    end))
    
    UpdatePlayers()
end

table.insert(Connections, UserInputService.InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.KeyCode == LibraryConfig.MenuKey and UI_Elements.MainFrame then 
        UI_Elements.MainFrame.Visible = not UI_Elements.MainFrame.Visible 
    end
end))


if isMobile then
    local MobileScreen = Instance.new("ScreenGui")
    MobileScreen.Name = "Alphax_Mobile_Toggle"
    MobileScreen.ResetOnSpawn = false
    MobileScreen.IgnoreGuiInset = true
    if syn and syn.protect_gui and not gethui then syn.protect_gui(MobileScreen) end
    MobileScreen.Parent = ParentObj

    local OpenBtn = Instance.new("TextButton")
    OpenBtn.Size = UDim2.new(0, 45, 0, 45)
    OpenBtn.Position = UDim2.new(0.5, -22, 0, 15)
    OpenBtn.BackgroundColor3 = LibraryConfig.Theme.Main or Color3.fromRGB(25, 25, 25)
    OpenBtn.TextColor3 = LibraryConfig.Theme.Accent or Color3.fromRGB(255, 255, 255)
    OpenBtn.Text = "Menu"
    OpenBtn.Font = Enum.Font.GothamBold
    OpenBtn.TextSize = 12
    OpenBtn.Parent = MobileScreen

    Instance.new("UICorner", OpenBtn).CornerRadius = UDim.new(1, 0)
    Instance.new("UIStroke", OpenBtn).Color = LibraryConfig.Theme.Outline or Color3.fromRGB(50, 50, 50)

    OpenBtn.MouseButton1Click:Connect(function()
        if UI_Elements.MainFrame then
            UI_Elements.MainFrame.Visible = not UI_Elements.MainFrame.Visible
        end
    end)
end

-- Expondo config no final (caso precise)

Library.Config = LibraryConfig

return Library
